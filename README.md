# Maritime Market Watch

Проект **Maritime Market Watch (MMW)** предназначен для мониторинга состояния морского рынка. Он собирает биржевые данные по судоходным компаниям, значения отраслевых индексов и новости из различных источников. В дальнейшем данные можно использовать для аналитики и построения визуализаций.

## Возможности
- Отслеживание цен акций судоходных компаний из наблюдаемого списка.
- Хранение исторических значений отраслевых индексов.
- Сбор новостей и базовая обработка текста.

## Установка и запуск
1. Убедитесь, что установлен **Python 3.11** или новее.
2. Создайте и активируйте виртуальное окружение:
   ```bash
   python -m venv .venv
   source .venv/bin/activate
   ```
3. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```
4. Инициализируйте базу данных (создастся файл `data/mmw.sqlite`):
   ```bash
   python -c "from mmw.db import init_db; init_db()"
   ```
5. Запустите утилиты проекта или разработку.

## Локальный запуск

После установки зависимостей доступна консольная утилита `mmw`:

```bash
mmw refresh-all   # загрузить цены, индексы и новости, обогатить и связать их
mmw build-site    # собрать статический сайт в docs/
mmw open-site     # открыть docs/index.html в браузере
```

Команда `mmw analyze` позволяет выполнить несколько простых аналитических запросов:

```bash
mmw analyze daily-returns ZIM SBLK  # посчитать дневные доходности
mmw analyze news-intensity          # агрегировать интенсивность новостей
```

Для простого дашборда можно запустить Streamlit:

```bash
streamlit run src/app_streamlit.py
```

## Структура проекта
- `src/mmw` — исходный код пакета.
- `data/` — каталог для хранения данных и базы SQLite.
- `docs/` — статические файлы документации.

Проект находится в активной разработке. Добро пожаловать к участию!

## Отчёт и GitHub Pages

Сгенерировать статический сайт с графиками, индексами и новостями можно командой:

```bash
python -m mmw.report
```

Файлы будут сохранены в каталоге `docs/`. Чтобы опубликовать их через GitHub Pages:

1. Откройте настройки репозитория на GitHub.
2. Перейдите в раздел **Pages**.
3. В качестве источника выберите ветку `main` и папку `/docs`.
4. Сохраните изменения — сайт станет доступен по адресу `https://<user>.github.io/<repo>/`.

## Цены (yfinance)
Загрузка котировок реализована через библиотеку [yfinance](https://github.com/ranaroussi/yfinance), которая получает данные из Yahoo Finance. Дополнительные ключи API не требуются.

Для обновления цен по списку наблюдения выполните:

```bash
python -m mmw.prices --since 2022-01-01
```

По умолчанию при отсутствии параметра `--since` загружаются данные за последние три года.

## Индексы
Проект может хранить значения отраслевых индексов. Исторические данные можно заносить вручную в файл `data/indices_manual.csv` и импортировать функцией `import_indices_from_csv()`.

- **HARPEX** — индекс фрахтовых ставок контейнерных судов от Harper Petersen. Официальная страница: https://www.harperpetersen.com/harpex
- **SCFI** — Shanghai Containerized Freight Index. Публикация: https://en.sse.net.cn/indices/scfi
- **WCI** — World Container Index (Drewry). Официальная страница: https://www.drewry.co.uk/supply-chain-expertise/world-container-index-drewry
- **FBX** — Freightos Baltic Index. Официальная страница: https://fbx.freightos.com/

Парсеры для получения текущих значений доступны, однако использовать их следует только если это не нарушает условия использования сайтов и правила robots.txt. В остальных случаях данные лучше загружать вручную через CSV.

Чтобы полностью отключить автоматический парсинг отдельных индексов, установите переменные окружения `MMW_SKIP_HARPEX`, `MMW_SKIP_WCI`, `MMW_SKIP_SCFI` или `MMW_SKIP_FBX`.

## Новости (RSS)
Проект может получать новости из открытых RSS-лент отраслевых изданий.
Примеры источников:

- [Hellenic Shipping News](https://www.hellenicshippingnews.com/feed/)
- [Maritime Executive](https://www.maritime-executive.com/rss)
- [gCaptain](https://gcaptain.com/feed/)

Новости можно загрузить и сохранить в базу данных командой:

```bash
python -m mmw.news
```

## Автоматическое обогащение и линковка новостей

Команда `mmw refresh-all` помимо загрузки цен и индексов собирает новости, создаёт краткие пересказы, выделяет сущности и пытается привязать статьи к тикерам и индексам.

Чтобы подключить дополнительные RSS-источники, задайте переменную окружения `MMW_EXTRA_FEEDS` со списком URL через запятую:

```bash
export MMW_EXTRA_FEEDS="https://example.com/feed/,https://foo.bar/rss"
mmw refresh-all
```

## AI без ключей

Проект содержит базовые функции обработки текста, которые работают без внешних API-ключей. Для краткого пересказа используется алгоритм TextRank из библиотеки `sumy`, а выделение сущностей выполняется при помощи `spaCy`. Полученные результаты предназначены лишь для упрощённой аналитики и не являются профессиональными рекомендациями.

## FAQ по ошибкам

- **`ModuleNotFoundError: No module named 'mmw'`** — убедитесь, что команды запускаются из корня репозитория или пакет установлен в активное окружение.
- **`sqlite3.OperationalError: no such table`** — инициализируйте базу данных: `python -c "from mmw.db import init_db; init_db()"`.
- **Не открывается сайт командой `mmw open-site`** — сначала выполните `mmw build-site`, затем повторите попытку.
